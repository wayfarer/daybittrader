{% extends "base_trade.html" %}
{% load bootstrap %}

{% block sidebar %}
<h4 class="clear">Active Trades</h4>
<ul class="trade-list">
{% for trade in trades %}
	<li class="trade-{{ trade.type }}"><strong>{{ trade.type }}</strong>: {{ trade.btc_amount }} BTC - ${{ trade.price_point }} (${{ trade.cost }})
		{% if trade.expired %}<strong style="color:red">EXPIRED</strong>{% endif %}
		<a href="?remove={{ trade.uuid }}" title="{% if trade.expired %}Remove{% else %}Cancel{% endif %}"
		{% if not trade.expired %} onclick="return confirm('Are you sure you want to cancel this trade?')"{% endif %}><span class="glyphicon glyphicon-remove-circle pull-right"></span></a>
	</li>
{% endfor %}
</ul>
{% endblock sidebar %}

{% block content %}
<div class="trade {{ trade_type }}">
	{% if cb_balance %}<h4 style="color:#666;">Coinbase Balance:
		<strong>{{ cb_balance }}</strong> &nbsp; Current {{ trade_type_lower }} price: <strong class="cb-last cb-{{ trade_type }}">${{ current_price }}*</strong><br>
		<small>Bitstamp: <strong class="bs-last">${{ bitstamp_price }}</strong>
			<span style="font-size: .8em">
				<a href="https://bitcointalk.org/index.php?topic=392422.0" target="_blank">Why Bitstamp?</a>
			</span></small>
			</h4>{% endif %}
	<form action="?save" method="post">
		{% csrf_token %}
		{{ form|bootstrap }}
		<p class="actions">
			<button type="submit" class="btn btn-large btn-primary">{{ submit_text }}</button>
		</p>
	</form>
	<p>*<small>Estimate only.  Includes all fees.</small></p>
</div>
<script>$('.trade label:eq(3)').hide();</script>
{% endblock content %}

{% block bottom %}
<script>
	$(document).ready(function() {
		$('<span> &nbsp <span class="priceinfo" id="actual-price"></span></span>').appendTo('label[for="id_price_point"]');
		$('#id_price_point, #id_btc_amount').keyup(function() {
			this.value = this.value.replace(/[^0-9\.]/g, '');
			var price_val = parseFloat($('#id_price_point').val());
			var btc_val = parseFloat($('#id_btc_amount').val());
			var actual_price = btc_val * price_val;
			if(!isNaN(actual_price)) {
				$('#actual-price').text(' $' + (Math.round(actual_price * 100) / 100).toString());
			}
			else {
				$('#actual-price').text('');
			}
		});
	});
</script>
<script src="{{ STATIC_URL }}js/trade.js"></script>
{% endblock bottom %}
